#  Device-Level Layout Concepts

Integrated circuit layout translates the schematic into **physical layers** on silicon.  
The IHP-SG13G2 process provides numerous layers such as active/diffusion regions, poly gates, contacts, multiple metal levels, and passivation. [@IHP_PDK_2024]  
Each of these layers plays a role in forming MOSFETs, capacitors, resistors, and interconnects, further layer specific description for the IHP PDK can be found on Layout Rules [@IHP_PDK_2024].  

Unlike digital design, where the goal is mainly connectivity, analog layout must ensure **matching, symmetry, and parasitic control**. This is particularly critical in our **folded-cascode OTA**, where the differential input pair, current mirrors, and cascode devices dominate the overall gain, offset, and common-mode rejection ratio (CMRR). [@baker2010; @lienig2020] 

The following subsections describe the major device-level layout techniques used in this work, with examples and figures suggested for illustration.


##  Matching & Symmetry

In real silicon, device characteristics are never perfectly uniform across the die.  
**Process gradients** arise during fabrication due to variations in temperature, pressure, and material distribution. These gradients can be visualized using concepts similar to **isobars** (lines with constant mechanical pressure) or **isotherms** (lines with same temperature), where physical properties gradually shift across the wafer surface [@lienig2020].  

Such gradients directly affect threshold voltage, mobility, and oxide thickness. As a result, two transistors with identical schematic dimensions may behave differently if placed at different positions on the chip. For analog circuits like OTAs, these mismatches degrade input offset, gain, and common-mode rejection ratio (CMRR).  

::: {#fig-isotherm .figure}
![](../figures/_fig_isotherm.svg)

Thermal gradients caused by non-uniform heat distributtion across the chip area. Best practice is to place the devices along the same isotherm. (adapted from @lienig2020) 
:::

::: {#fig-isobar .figure}
![](../figures/_fig_isobar.svg)

Contradictory to above gradient in mechnical stress high gradient area should be avoided such as corners and devices should be placed closer to chip center lines (adapted from @lienig2020). 
:::


To minimize this, layout must enforce **symmetry**:

- **Symmetry around an axis.**  
  Devices intended to operate as pairs, such as the OTA differential input transistors, are placed symmetrically about a central axis. This ensures that any linear process gradient affects both devices equally, preserving balance in their electrical behavior.  

- **Symmetry in current flow.**  
  Symmetry is not only geometrical but also electrical. The orientation of source, drain, and gate terminals is arranged so that current flows through matched devices in identical directions. This prevents systematic mismatches introduced by unequal diffusion edge proximity or channel orientation.  

Together, these forms of symmetry improve **matching**  the ability of two devices to exhibit nearly identical electrical performance. Accurate matching is critical in the OTA’s input stage, where small imbalances directly appear as input offset voltages.  

Finally, symmetry must extend to the **routing**. Interconnect lengths, widths, and via stacks must be balanced on both sides of the differential pair. Even with well-matched devices, asymmetric wiring can introduce additional resistance and capacitance, which shows up as systematic offset or degraded bandwidth [@lienig2020; @baker2010].  
In our OTA layout, routing symmetry was not only maintained in terms of path length and via balance, but also extended to the **choice of metal layers**. Long interconnects were assigned to **higher metal layers** with lower sheet resistance, while short local connections remained on **lower metals** for compact access.  
This combination of length balancing, via symmetry, and layer assignment ensured that both differential branches exhibited comparable parasitic resistance and capacitance, preserving matching despite unavoidable topological constraints.  


##  Multi-Fingering

When MOSFETs are designed with very wide channel widths, implementing them as a single continuous device introduces several problems. A long, uninterrupted polysilicon gate line introduces significant **polysilicon gate resistance**, which degrades high-frequency behavior and increases phase delay. At the same time, the enlarged diffusion regions lead to higher source and drain junction capacitances, creating substantial loading on sensitive circuit nodes. Finally, wide monolithic devices suffer in terms of matching: process gradients across the active area are no longer averaged, making these devices more vulnerable to systematic variation and random mismatch effects [@baker2010; @lienig2020].  

The solution is **multi-fingering**: dividing the wide transistor into several narrower, identical fingers that are connected in parallel. This segmentation reduces gate resistance (shorter poly stripes), distributes junction capacitances more evenly, and improves statistical matching by averaging across multiple smaller units.  

In our OTA, the **tail current source** required a total width of 8.5 µm. Instead of realizing it as a single device, it was split into **four fingers of 2.125 µm each**. This segmentation reduced the distributed gate resistance, improved current uniformity, and made gate routing more compact and symmetrical, while maintaining acceptable junction capacitance at the high-impedance tail node. Similarly, majority of transistors were implemented in multi-finger form to balance parasitic capacitances and maintain symmetry across branches.

::: {#fig-ota_tail .figure}
![](../figures/_fig_tail_transistor.png)

Represents the tail transistor in our layout with 4 fingers instead of one huge block lead to well matched layout with other transistors and clean routing. 
:::

Despite its benefits, multi-fingering comes with trade-offs:  
- **Increased routing overhead**, since all fingers must be tied together with well-balanced interconnect.  
- **Extra junction perimeters**, which can increase total parasitic capacitance if the layout is not compacted carefully.  
- **Via placement sensitivity**, as each finger requires source/drain contacts and vias; poor via distribution can lead to resistance mismatches or electromigration concerns. Using 2 vias is always recommended.[@lienig2020]

For this reason, multi-fingering is often combined with other layout strategies.  
**Dummies** are placed at the array edges to shield active fingers, while **common-centroid arrangements** may be used for further gradient cancellation. This combined approach was applied in our OTA’s diffpair, ensuring both parasitic reduction and high matching fidelity.

::: callout-note 
# How to calculate minimum number of fingers

Determining the appropriate number of fingers for a wide MOSFET is not arbitrary; it requires balancing several parasitic and physical effects.  

As excessive fingering increases total diffusion perimeter and further elevating the total source/drain junction capacitance.  

Therefore, selecting the *minimum* number of fingers that satisfies these electrical and physical constraints is essential for achieving optimal analog performance.

A rigorous methodology for estimating this minimum finger count considering gate resistance limits, diffusion capacitance contributions, layout symmetry, and manufacturability is presented in **Section 7.6: Finger Count Estimation**, where all the equations and procedures are discussed in detail.
:::

##  Dummy Devices

Even when multi-fingering is used, the **edge fingers** of a device array experience different fabrication conditions compared to the inner fingers. At the boundary between active diffusion and isolation (STI), variations in oxide growth, stress, and implant profiles create **edge effects** that change threshold voltage, carrier mobility, and junction capacitance [@baker2010].  
If left unaddressed, these systematic differences degrade device matching, particularly in sensitive analog structures such as the OTA input pair or current mirrors.  

To eliminate this, **dummy devices** are placed at the ends of transistor arrays. They act as sacrificial neighbors, ensuring that all *active* devices are surrounded by identical environments.  
This makes the inner devices more uniform, effectively shielding them from edge-related mismatches.[@lienig2020]  

Connection of dummy devices can vary across design flows:  
- In some methodologies, dummy gates are left **floating**, since their only role is geometric.  
- In others, dummies are **tied to supply rails** (AVDD or AVSS) to avoid LVS errors and ensure consistent recognition by verification tools.  

In our OTA, Dummy devices were placed at the edges of all the MOSFET's. This ensured that all transistors within the OTA operated in well-matched environments, minimizing systematic offset.

::: {.callout-important title="Important Implementation Note" collapse=true} 

In our OTA layout, dummy devices were implemented as **complete MOSFETs** with their gates explicitly tied to **AVDD** or **AVSS**.  
This was necessary because in **KLayout**, adding an extra finger with an unconnected gate/source/drain is not recognized as a dummy. LVS then fails due to netlist mismatches.  

To ensure **LVS clean results**, we:  
- Added dummy devices explicitly in the schematic.  
- Connected all terminals to valid nets.  
- Replicated the same connections in layout.  
:::


##  Interdigitated Layout

When two matched transistors are placed adjacent to each other but in separate diffusion regions, each device is exposed to a slightly different portion of the process gradient across the chip. As a result, parameters such as threshold voltage, carrier mobility, and oxide thickness vary between them, leading to a systematic mismatch even though both devices have identical drawn dimensions.  

The **interdigitated layout technique** addresses this issue by physically alternating the unit devices of a matched pair or array. Instead of grouping devices as AABB, the transistors are arranged in an alternating or mirrored pattern such as **ABAB** or **ABBA**, where *A* and *B* represent identical unit devices belonging to two matched elements.  
Through this alternating placement, each device is spatially distributed across the gradient, allowing it to experience regions of both higher and lower process variations. As a result, the local fabrication differences are **averaged** out across all unit fingers, and the two devices become physically and electrically better matched under real process conditions.

::: {#fig-abba .figure}
![](../figures/_fig_abba.svg)

Shows the interdigitated layout pattern "ABBA" (right) of current mirror schematic of NMOS-FETs with current ratio 1:1(left). The "D" gates in layout represent the Dummy transistors.[@lienig2020] 
:::


This concept can be visualized by imagining a linear gradient across the x-axis of the die. If one device occupies the left region and the other the right, they sample distinct gradient values. However, when their unit fingers are interleaved, each device occupies multiple local regions along the gradient, resulting in matched *average parameters*.

In practice, interdigitation is most effective for **linear process gradients** along one direction and is often used for **matched transistor pairs, current mirrors, or differential input stages**.  
For two-dimensional gradients or more complex variations, this technique is typically extended using **common-centroid placement** (discussed in the next section).

In the folded cascode OTA, **interdigitation** was applied to the active loads and bias current mirrors. This layout ensured that each mirrored transistor experienced an equivalent average doping and oxide thickness, resulting in better current matching, symmetrical output swing, and reduced systematic offset in bias generation.


##  Common-Centroid Layout

While interdigitation cancels **first-order linear gradients** along a single direction, it cannot fully correct for **two-dimensional or higher-order variations** such as diagonal gradients or wafer-level curvature. For more advanced matching requirements such as in precision current mirrors or differential pairs in high-gain OTAs **common-centroid layout** is used.

In a common-centroid configuration, matched devices are arranged so that their geometric centers, or **centroids**, coincide. Each device is distributed symmetrically around a central point such that any gradient whether horizontal, vertical, or diagonal affects both devices equally when averaged over their area. This approach effectively cancels first-order gradient components in both axes and reduces second-order effects as well [@lienig2020].

Conceptually, the centroid layout extends the interdigitated approach into two dimensions. For example, four identical transistors can be arranged symmetrically around a central point in an AB/BA pattern, forming what is effectively a square or cross-shaped configuration.

::: {#fig-common_centroid.figure}
![](../figures/_fig_common_centroid.svg)

Illustrates how common centroid configuration can be achieved (right) of current mirror schematic of NMOS-FETs with current ratio 1:1(left). Its clear that devices are extremely symmetrical along X-and Y-axis, however routing always introduces some asymmetry which can be neglected for time being. Here, space is intentionally left between transistors for clear visuals and understanding. The "D" gates in layout represent the Dummy transistors. 
:::

Although each individual finger occupies a slightly different position on the chip and therefore a slightly different local environment the geometric center (centroid) of all devices coincides. This ensures that the averaged electrical properties of each device are identical, effectively cancelling first-order process gradients across both axes.

In our folded-cascode OTA, the **diff pair** was laid out using a **common-centroid pattern** derived from the AB/BA principle. This was essential to maintain current accuracy and minimize systematic gain variation.  
The layout ensured that matched transistors experienced a balanced environment, even in the presence of lateral thermal gradients or stress gradients from nearby metal density variations.

**Routing Considerations:**  
Achieving symmetry in interconnect is as critical as maintaining symmetry in device placement. In principle, identical path lengths, matched metal layers, and mirrored via distributions help ensure that the parasitic resistances and capacitances experienced by paired devices remain equal. However, practical experience reveals that *strict geometric symmetry does not always translate into optimal electrical symmetry*, especially in multi-metal processes such as IHP-SG13G2.

A notable observation from our layout work illustrates this point clearly. In most of tech nodes including IHP-sg13g2 lower metal layers (Metal1, Metal2) exhibit **higher sheet resistance**, they are typically used for short internal routing, while upper metals provide lower resistance and reduced coupling.   
In an attempt to maximize matching, the initial differential-pair routing was implemented almost entirely on the lowest metal layers (Metal1 and Metal2), with perfectly mirrored path lengths and identical layer usage on both branches. Although geometrically symmetric, this approach resulted in **severe performance degradation**: the differential pair failed to operate correctly.  
Post-layout analysis revealed that the close proximity of long parallel segments on the same or adjacent lower metal layers introduced **excessive lateral and broadside capacitances**, overwhelming the high-impedance input nodes and collapsing the expected differential behavior.

This led to a revised routing strategy grounded in parasitic-aware symmetry rather than purely geometric symmetry. The final solution employed a combination of **Metal1, Metal2, and Metal3**, arranged such that the two branches remained electrically matched but **did not rely on identical metal layers running in close parallel**. Where parallelism was unavoidable, routing was staggered (e.g., $Metal_n$ with $Metal_{n+2}$) to reduce capacitive coupling.  
This parasitic-conscious routing produced a substantial improvement in OTA performance, restoring gain and achieving stable differential operation.

These findings highlight that in precision analog layout, **symmetry must be interpreted electrically, not only geometrically**. Effective matching requires an awareness of sheet-resistance gradients, metal-layer coupling, and the spatial distribution of parasitics. 

Meticulous routing decisions layer staggering, spacing, orthogonality, and controlled via placement often determine whether a differential structure performs ideally or fails entirely.


##  Finger Count Estimation (Minimum Number of Fingers)

This section establishes a systematic method for estimating the **minimum number of fingers** $N_f$ required for a wide MOSFET such that  
(i) the **distributed gate resistance** remains below acceptable limits, and  
(ii) the **junction capacitances** introduced by segmentation do not dominate the node dynamics.  
The methodology follows the classical treatment of **gate resistance**, **thermal/gate noise**, and **diffusion capacitance scaling** described in [@Prof_Razavi_2001; @Prof_Razavi_2011].

For a device with total drawn width $W_{tot}$ and channel length *L*, splitting the device into $N_f$ identical fingers results in an effective per-finger width

$$
W_f = \frac{W_{\text{tot}}}{N_f}.
$$

Selecting $N_f$ is therefore an exercise in determining how narrow each finger can be made before device performance becomes degraded by source drain capacitance, or minimum-geometry constraints.  

The following design principles guide the estimation procedure:


###  **Gate Resistance Requirement (Low-Noise Criterion)**

As a practical thumb rule used in low-noise analog design:

> Each finger width $W_f$ must be chosen such that the **gate resistance** of that finger is **less than** the inverse transconductance $1/g_m$ associated with that finger.  
> For high-performance or low-noise applications, the gate resistance should preferably be in the range of  
$$
R_g < \frac{1}{5 g_m} \quad \text{to} \quad R_g < \frac{1}{10 g_m}
$$

This condition ensures that the **gate thermal noise contribution** remains significantly below the **channel thermal noise**, preventing degradation of input-referred noise or gain.[@Prof_Razavi_2011]

Basically, we compare the **channel thermal noise** with the **gate-resistance thermal noise**, and we solve to get the value of $N_f$ ensuring that gate noise remains well below channel noise.

**Channel noise:**

$$
\overline{v_{n,\text{ch}}^2} = \frac{4 k T\, \gamma}{g_m}
$$


**Gate-resistance noise:**

$$
\overline{v_{n,\text{g}}^2} = \frac{4 k T R_{sheet} W}{3 L N_f^2} 
$$

where,

- *k* is Boltzmann’s constant,
- *T* is the absolute temperature,
- $\gamma$ is the noise factor
- $g_m$, W & L are the transconductance, width and length of the device.

In our application, Channel noise is 5 times that of Gate-resistance noise. 

### **Noise Model Adjustment Based on Channel Length**

The optimization also depends on the **noise coefficient *$\gamma$*** in the MOSFET thermal noise model. The correct value of $\gamma$ depends on the channel length:

- If $L < 3 \times L_{min}$, then $\gamma = 1$  
- otherwise, $\gamma = \frac{2}{3}$

Because shorter-channel devices exhibit stronger velocity saturation and increased thermal noise.


### **Minimum Geometry Constraint**

The number of fingers must also satisfy:

$$
\frac{W_{\text{tot}}}{N_f} > L_{\min},
$$

because excessively narrow fingers approach the **minimum manufacturable width** and exhibit strong proximity effects, increased mismatch, and higher perimeter capacitance.[@Prof_Razavi_2001]
For the IHP-SG13G2 130-nm process used here, as the name suggests the minimum channel length is:

$$
L_{\min} = 0.13\,\mu\text{m}.
$$

This constraint prevents unrealistic fingering.

### **Even Number of Fingers (Practical Layout Consideration)**

Although electrically permissible, **odd-valued finger counts** typically complicate routing and disrupt symmetry. Although in fewer cases odd numbered fingers are used as well.  
But, a practical recommendation particularly in differential or current-mirror structures is:

Choose the **minimum even number of fingers** $N_f$ that satisfies the electrical and geometrical constraints. Even segmentation simplifies mirrored routing, centroid or interdigitated arrangements, and guard ring alignment.

::: {.callout-note title="Number of fingers Calculation using Python Script" collapse="true"}

To support the design methodology described above, a dedicated **Python script** has been developed to automatically compute the **minimum number of fingers** required for any given MOSFET width.  
The script implements the **thumb-rule constraints** introduced above.
By providing required parameters, the script outputs the **minimum feasible even-valued $N_f$** that satisfies all electrical constraints. 

The script can be found in Appendix C.
:::